{% extends "site.html" %}

<!-- Title -->
{% block title %}
    Suche
{% endblock title %}

<!-- Content -->
{% block content %}
    <div class="content">
        <h1>Lizenz erstellen</h1>
        <form id="form" method="post">
            <div class="form-group">
                <label for="key">Lizenzschlüssel</label>
                <input type="text" class="form-control" id="key" placeholder="Lizenzschlüssel eingeben" maxlength="255" required>
            </div>
            <div class="form-group">
                <label for="detail">Details</label>
                <textarea class="form-control" id="detail" rows="5" placeholder="Details eingeben" maxlength="2047" required></textarea>
            </div>
            <div class="form-group">
                <label for="start_date">Anfangsdatum</label>
                <input type="date" class="form-control" id="start_date" required>
            </div>
            <div class="form-group">
                <label for="end_date">Enddatum</label>
                <input type="date" class="form-control" id="end_date" required>
            </div>
            <div class="form-group">
                <label for="module">Software-Modul</label>
                <select id="module" class="mdb-select md-form" searchable="Modul wählen..." required>
                    <option value="" disabled selected>Bitte Modul auswählen</option>
                    {% for module in modules %}
                        <option value="{{module.id}}">{{module.name}}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="location">Standorte</label>
                <select id="location" class="mdb-select md-form" searchable="Standort wählen...">
                    <option value="" disabled selected>Bitte Standort auswählen</option>
                    {% for location in locations %}
                        <option value="{{location.id}}">{{location.name}}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="customer">Kunde</label>
                <select id="customer" class="mdb-select md-form" searchable="Kunden wählen...">
                    <option value="" disabled selected>Bitte Kunden auswählen</option>
                    {% for customer in customers %}
                        <option value="{{customer.id}}">{{customer.name}}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Erstellen</button>
            <button type="button"
                class="btn btn-danger"
                onclick="location.href=`{% url 'licenses_list' %}`;"
            >Abbrechen</button>
        </form>
    </div>
    <script>
        /* $(document).ready(() => {
            $('.mdb-select').materialSelect();
        }); */
        $('#form').on('submit', (event) => {
            event.preventDefault();
            $.ajax({
                type : "POST", 
                url  : "{% url 'licenses_save' %}",
                data : {
                    key                 : $('#key').val(),
                    detail              : $('#detail').val(),
                    start_date          : $('#start_date').val(),
                    end_date            : $('#end_date').val(),
                    module              : $('#module').val(),
                    location            : $('#location').val(),
                    customer            : $('#customer').val(),
                    csrfmiddlewaretoken : '{{ csrf_token }}',
                    dataType            : "json",
                },
            });
        });
    </script>
{% endblock content %}
